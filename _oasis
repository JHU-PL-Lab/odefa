Name: Odefa
Version: 0.2
Synopsis: An implementation of DDPA analysis.
Authors: JHU PL Lab <pl.cs@jhu.edu>
License: Apache

Description: An implementation of DDPA analysis.
Homepage: http://www.big-bang-lang.org/

OASISFormat: 0.4
BuildTools: ocamlbuild
Plugins: META (0.4), DevFiles (0.4)
AlphaFeatures: ocamlbuild_more_args
XOCamlbuildExtraArgs: -use-menhir -use-ocamlfind
BuildDepends: threads

# The following allows individual developers to customize their environments
# (e.g. reposition the _build directory via a symlink) on build.
PreBuildCommand: ./.execute_if_exists ./.local_prebuild
PreCleanCommand: ./.execute_if_exists ./.local_preclean

Library "utils"
  Path: src/utils
  Modules:
    Dot_file_logger_utils,
    Dot_file_logger_utils_types,
    Logger_utils,
    Monad_utils,
    Multimap,
    Multimap_pp,
    Nondeterminism,
    Parser_support,
    Pp_utils,
    Source_origin,
    String_utils,
    Uid,
    Utils
  BuildDepends:
    batteries,
    monadlib,
    ocaml-monadic,
    ppx_deriving.std

Library "core-ast"
  Path: src/core-ast
  Modules:
    Core_ast,
    Core_ast_pp,
    Core_ast_tools,
    Core_ast_wellformedness
  BuildDepends:
    batteries,
    ppx_deriving.std (>= 3.2),
    utils

Library "core-parser"
  Path: src/core-parser
  Modules:
    Core_generated_lexer,
    Core_generated_parser,
    Core_parser
  BuildDepends:
    batteries,
    core-ast,
    utils
  BuildTools+:
    ocamllex,
    menhir

Library "core-interpreter"
  Path: src/core-interpreter
  Modules:
    Core_interpreter
  BuildDepends:
    batteries,
    core-ast,
    utils

Library "nested-ast"
  Path: src/nested-ast
  Modules:
    Nested_ast
  BuildDepends:
    batteries,
    core-ast,
    utils

Library "swan-ast"
  Path: src/swan-ast
  Modules:
    Swan_ast
  BuildDepends:
    batteries,
    core-ast,
    utils

Library "nested-parser"
  Path: src/nested-parser
  Modules:
    Nested_generated_lexer,
    Nested_generated_parser,
    Nested_parser
  BuildDepends:
    batteries,
    nested-ast,
    utils
  BuildTools+:
    ocamllex,
    menhir

Library "swan-parser"
  Path: src/swan-parser
  Modules:
    Swan_generated_lexer,
    Swan_generated_parser,
    Swan_parser
  BuildDepends:
    batteries,
    swan-ast,
    utils
  BuildTools+:
    ocamllex,
    menhir

Library "a-translator"
  Path: src/a-translator
  Modules:
    A_translator
  BuildDepends:
    batteries,
    core-ast,
    nested-ast,
    utils

Library "swan-translator"
  Path: src/swan-translator
  Modules:
    Swan_translator
  BuildDepends:
    batteries,
    core-ast,
    nested-ast,
    swan-ast,
    utils

Library "pds-reachability"
  Path: src/pds-reachability
  Modules:
    Pds_reachability_analysis,
    Pds_reachability_basis,
    Pds_reachability_logger_utils,
    Pds_reachability_logger_utils_types,
    Pds_reachability_structure,
    Pds_reachability_types,
    Pds_reachability_types_stack,
    Pds_reachability_work,
    Pds_reachability_work_collection,
    Pds_reachability_work_collection_templates,
    Pds_reachability
  BuildDepends:
    utils,
    batteries,
    ppx_deriving.std (>= 3.2)

Library "pds-programming"
  Path: src/pds-programming
  Modules:
    Pds_programming,
    Ppx_utils
  BuildDepends:
    compiler-libs.common,
    pds-reachability,
    ppx_tools,
    ppx_tools.metaquot,
    utils,
    batteries

Executable "ppx_pds_programming"
  Path: src/ppx-pds-programming
  MainIs: ppx_pds_programming.ml
  CompiledObject: native
  BuildDepends:
    compiler-libs.common,
    pds-reachability,
    ppx_tools,
    ppx_tools.metaquot,
    pds-programming,
    utils,
    batteries

Library "ddpa-analysis"
  Path: src/ddpa-analysis
  Modules:
    Ddpa_analysis,
    Ddpa_context_stack,
    Ddpa_data_structures,
    Ddpa_graph,
    Ddpa_graph_logger,
    Ddpa_graph_logger_types,
    Ddpa_nonrepeating_stack,
    Ddpa_n_element_stack,
    Ddpa_single_element_stack,
    Ddpa_two_element_stack,
    Ddpa_unit_stack,
    Ddpa_utils
  BuildDepends:
    core-ast,
    pds-reachability,
    batteries,
    ppx_deriving.std (>= 3.2),
    monadlib,
    ocaml-monadic (>= 0.3.1)

Library "toploop-utils"
  Path: src/toploop-utils
  Modules:
    Toploop_ddpa,
    Toploop_ddpa_types,
    Toploop_options
  BuildDepends:
    core-ast,
    ddpa-analysis,
    batteries,
    monadlib,
    ocaml-monadic (>= 0.3.1),
    ppx_deriving.std (>= 3.2),
    utils

Executable "core-toploop"
  Path: src/core-toploop
  MainIs: core_toploop.ml
  CompiledObject: native
  BuildDepends:
    core-ast,
    ddpa-analysis,
    core-interpreter,
    core-parser,
    toploop-utils,
    batteries

Executable "nested-toploop"
  Path: src/nested-toploop
  MainIs: nested_toploop.ml
  CompiledObject: native
  BuildDepends:
    a-translator,
    core-ast,
    nested-ast,
    core-interpreter,
    nested-parser,
    toploop-utils,
    batteries

Executable "swan-toploop"
  Path: src/swan-toploop
  MainIs: swan_toploop.ml
  CompiledObject: native
  BuildDepends:
    a-translator,
    core-ast,
    core-interpreter,
    nested-ast,
    swan-ast,
    swan-parser,
    swan-translator,
    toploop-utils,
    batteries

Executable "test"
  Path: test/
  MainIs: test.ml
  CompiledObject: native
  ByteOpt+: -ppx src/ppx-pds-programming/ppx_pds_programming.native
  NativeOpt+: -ppx src/ppx-pds-programming/ppx_pds_programming.native
  BuildDepends:
    utils,
    pds-reachability,
    core-interpreter,
    core-parser,
    ppx_deriving.std,
    oUnit,
    batteries,
    ddpa-analysis,
    toploop-utils,
    nested-ast,
    swan-ast,
    swan-translator,
    pds-programming,
    ppx_tools,
    ppx_tools.metaquot

Test test
  Command: $test

Executable "benchmark"
  Path: benchmark/
  MainIs: benchmark.ml
  CompiledObject: native
  BuildDepends:
    utils,
    pds-reachability,
    core-interpreter,
    core-parser,
    ppx_deriving.std,
    oUnit,
    batteries,
    ddpa-analysis,
    toploop-utils
